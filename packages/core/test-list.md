# Core ビジネスロジック テストリスト - Age of Hero

**作成日**: 2025-09-12  
**対象**: Age of Hero キャラクター作成・管理のビジネスロジック実装  
**責務**: UI非依存のピュアなロジック、計算処理、制約チェック

## 🎯 能力値計算ロジック

### 基本能力値計算 ✅ **完了**
- [x] **2つのクラス合算**: 選択した2つのクラスの能力値が合算されること
  - [x] 異なるクラスの場合（マッスル + テクノロジー）
  - [x] 同一クラスの場合（マッスル + マッスル = 2倍）
- [x] **全能力値対応**: すべての能力値（physical, reflex, sensory, intellectual, supernatural）
- [x] **+1ボーナス適用**: 指定した能力値に+1ボーナスが適用されること
- [x] **HP/SP計算**: 2つのクラスのHP/SPを合算すること
- [x] **行動値計算**: 反射×2+知力の正しい計算
  - [x] 基本計算（ボーナス適用前）
  - [x] +1ボーナス適用後の再計算

**実装完了**: `calculateAbilities(classes, bonusAbility?)` 関数
- 8つのテスト全通過
- TypeScript型安全性確保
- 純粋関数による副作用なし設計

## 🎯 技能管理ロジック

### 技能初期値計算 ✅ **完了**
- [x] **技能初期値**: 各技能の初期値が能力値×10で計算されること
  - [x] 肉体系技能（パワー、タフネス、スタミナ）
  - [x] 反射系技能（技術、射撃、運転）  
  - [x] 感覚系技能（知覚、捜索、追跡）
  - [x] 知力系技能（情報、医療、動物）
  - [x] 超常系技能（超常、次元、時間）

**実装完了**: `calculateSkillInitialValues(abilities)` 関数
- 17のテスト全通過
- 全16技能の初期値計算対応
- SKILLS定義に基づく動的計算

### 技能ポイント配分
- [doing] **ポイント割り振り**: 150%分の技能ポイント配分ロジック
  - [ ] 個別技能への配分（上限100%/技能）
  - [ ] 合計150%の制約チェック
  - [ ] 最終技能値計算（初期値 + 配分ポイント）

## 🎯 装備・スキル制約チェック

### ヒーロースキル制約 🔄 **データ構造修正中**
- [x] **レベル制約**: 各スキルの最大レベルを超えないこと
- [x] **合計レベル制約**: 合計7Lv分の制約チェック
- [x] **~~クラス制約~~**: ~~選択クラスに対応するスキルのみ選択可能~~ → 撤廃（UI側で推奨制御）
- [doing] **データ構造修正**: 名前のみ → 完全なスキル情報セット（name, level, maxLevel, timing, skill, target, range, cost, effect）
- [ ] **validateHeroSkills関数更新**: 新しいデータ構造に対応
- [ ] **テスト更新**: 新しいデータ構造に対応したテストケース修正

### 必殺技制約 ✅ **完了**
- [x] **データ構造定義**: 完全な必殺技情報セット（name, level, maxLevel, timing, skill, target, range, cost, effect）
- [x] **レベル制約**: レベルが1以上であること
- [x] **最大レベル制約**: レベルがmaxLevelを超えないこと
- [ ] **取得制約**: 1Lvの必殺技を1つ取得

**実装完了**: `validateSpecialAttackConstraints(characterData)` 関数
- 4つのテスト全通過
- TypeScript型安全性確保
- レベル制約の完全な検証

### アイテム制約
- [ ] **価格制約**: 価格20点分のアイテム選択
- [ ] **種別制約**: 武器・防具・消耗品の制約チェック

## 🧮 統合計算ロジック

### キャラクター作成フロー
- [ ] **完全なキャラクター作成**: すべてのステップを統合したロジック
  1. クラス選択 → 能力値計算
  2. +1ボーナス適用 → 最終能力値確定  
  3. 技能初期値計算 → ポイント配分
  4. ヒーロースキル・特殊技選択
  5. HP/SP/行動値の最終計算

### データ検証
- [ ] **入力値検証**: 不正な入力に対するエラーハンドリング
  - [ ] 存在しないクラス名
  - [ ] 無効な能力値名
  - [ ] 範囲外の数値
- [ ] **制約違反検証**: ゲームルール違反の検出
  - [ ] 技能ポイント超過
  - [ ] スキルレベル超過
  - [ ] アイテム価格超過

---

## 📝 実装方針

### TDDアプローチ
- **小さなテスト1つ**: 各機能を小さなテストから開始
- **RED → GREEN → REFACTOR**: 厳格なTDDサイクル遵守
- **データドリブンテスト**: `it.each`を積極的に活用

### 技術スタック  
- **TypeScript**: 型安全なビジネスロジック
- **Vitest**: 軽量で高速なテストフレームワーク
- **純粋関数**: 副作用のないピュアな関数設計

### ディレクトリ構成
```
packages/core/src/
├── ability-calculation/     # 能力値計算ロジック
├── skill-management/        # 技能管理ロジック  
├── character-creation/      # キャラクター作成統合ロジック
└── game-data/              # マスターデータ
```

### 完了基準
- 全テストの通過
- 型チェックの通過
- フロントエンドから使用可能な公開API完成